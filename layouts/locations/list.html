{{ define "main" }}
<div class="main-content">
  <div class="headerstyle item">
    <h1>{{ .Title }}</h1>
  </div>
  
  <div class="locations-page">
    {{ $days := slice "sun" "mon" "tue" "wed" "thu" "fri" "sat" }}
    {{ $dayNames := dict "sun" "Sunday" "mon" "Monday" "tue" "Tuesday" "wed" "Wednesday" "thu" "Thursday" "fri" "Friday" "sat" "Saturday" }}
    
    {{ range $i, $loc := site.Data.locations.locations }}
      {{ $index := printf "loc-%d" $i }}
      <div class="location-card">
        <div class="location-header">
          <h2>{{ .address }}</h2>
          {{ if or .city .island }}
            <p class="location-meta">
              {{ if .city }}{{ .city }}{{ end }}{{ if and .city .island }}, {{ end }}{{ if .island }}{{ .island }}{{ end }}
            </p>
          {{ end }}
        </div>

        <!-- Open Status -->
        <div class="openstatus center" id="opensign-{{ $index }}-page">
          <span class="status-badge open hide">Open</span>
          <span class="status-badge closed hide">Closed</span>
          <span class="status-badge opens-soon hide">Opens Soon</span>
          <span class="status-badge closes-soon hide">Closes Soon</span>
        </div>

        <!-- Location Actions -->
        <div class="location-actions">
          {{ if .latlon }}
            <a href="https://www.ttmenus.com/map/?lat={{ index .latlon 0 }}&lng={{ index .latlon 1 }}&zoom=19&client={{ $.Title | urlize }}" 
               class="btn location-btn" target="_blank">
              <img class="icon" src="https://cdn.ttmenus.com/icons/utilities/location.svg" alt="Location">
              <span>View on Map</span>
            </a>
          {{ end }}
          
          {{ if .whatsapp }}
            <a href="https://wa.me/{{ .whatsapp }}" class="btn location-btn" target="_blank">
              <img class="icon" src="https://cdn.ttmenus.com/icons/socialmedia/whatsapp.svg" alt="WhatsApp">
              <span>WhatsApp</span>
            </a>
          {{ end }}
          
          {{ if .phone }}
            <a href="tel:{{ .phone }}" class="btn location-btn">
              <img class="icon" src="https://cdn.ttmenus.com/icons/utilities/phone.svg" alt="Phone">
              <span>Call</span>
            </a>
          {{ end }}
        </div>

        <!-- Ordering Options -->
        {{ if .orderingtables }}
          <div class="ordering-options">
            <h3>Ordering Options</h3>
            <ul>
              {{ range .orderingtables }}
                <li>{{ . }}</li>
              {{ end }}
            </ul>
          </div>
        {{ end }}

        <!-- Delivery Options -->
        {{ if .delivery }}
          <div class="delivery-options">
            <h3>Delivery</h3>
            {{ if .delivery.fooddrop }}
              <a href="{{ .delivery.fooddrop }}" class="btn delivery-btn" target="_blank">
                <img src="/branding/other/fd.webp" alt="FoodDrop" style="max-width: 4em;">
                <span>Order via FoodDrop</span>
              </a>
            {{ end }}
          </div>
        {{ end }}

        <!-- Opening Hours -->
        {{ with .opening_hours }}
          {{ $oh := . }}
          <div class="opening-hours">
            <h3>Opening Hours</h3>
            
            <!-- Today's Hours -->
            <div class="today-hours-display">
              <strong>Today:</strong>
              <span class="today-hours-text">Loading...</span>
            </div>

            <!-- All Hours -->
            <details class="hours-accordion">
              <summary>View All Hours</summary>
              <ul class="all-hours-list">
                {{ range $days }}
                  {{ $day := . }}
                  {{ $dayName := index $dayNames $day }}
                  {{ with index $oh $day }}
                    {{ $entries := index $oh $day }}
                    {{ $openList := where $entries "type" "Open" }}
                    {{ $closeList := where $entries "type" "Close" }}
                    {{ $open := index $openList 0 }}
                    {{ $close := index $closeList 0 }}
                    <li class="hours-item" data-day="{{ $day }}">
                      <strong>{{ $dayName }}:</strong>
                      {{ if and $open $close }}
                        {{ $openTime := $open.time }}
                        {{ $closeTime := $close.time }}
                        
                        {{ if and $openTime $closeTime }}
                          {{ $openParts := split $openTime ":" }}
                          {{ $closeParts := split $closeTime ":" }}
                          
                          {{ $openHour := int (index $openParts 0) }}
                          {{ $openMin := index $openParts 1 }}
                          {{ $openAMPM := cond (ge $openHour 12) "PM" "AM" }}
                          {{ $open12 := mod $openHour 12 | default 12 }}
                          
                          {{ $closeHour := int (index $closeParts 0) }}
                          {{ $closeMin := index $closeParts 1 }}
                          {{ $closeAMPM := cond (ge $closeHour 12) "PM" "AM" }}
                          {{ $close12 := mod $closeHour 12 | default 12 }}
                          
                          <span class="hours-time">{{ printf "%d:%s%s â€“ %d:%s%s" $open12 $openMin (lower $openAMPM) $close12 $closeMin (lower $closeAMPM) }}</span>
                        {{ else }}
                          <span class="hours-time closed">Closed</span>
                        {{ end }}
                        
                      {{ else }}
                        <span class="hours-time closed">Closed</span>
                      {{ end }}
                    </li>
                  {{ else }}
                    <li class="hours-item" data-day="{{ $day }}">
                      <strong>{{ $dayName }}:</strong>
                      <span class="hours-time closed">Closed</span>
                    </li>
                  {{ end }}
                {{ end }}
              </ul>
            </details>
          </div>
        {{ else }}
          <div class="opening-hours">
            <p><em>Opening hours not available</em></p>
          </div>
        {{ end }}
      </div>
    {{ end }}
  </div>
</div>

<script>
// Initialize opening hours display for locations page
(function() {
  'use strict';
  
  function formatTime(time) {
    if (!time) return 'Closed';
    const parts = time.split(':');
    const hour = parseInt(parts[0]);
    const min = parts[1];
    const ampm = hour >= 12 ? 'PM' : 'AM';
    const hour12 = hour % 12 || 12;
    return `${hour12}:${min}${ampm.toLowerCase()}`;
  }
  
  function updateTodayHours() {
    const today = new Date().getDay();
    const dayMap = { 0: 'sun', 1: 'mon', 2: 'tue', 3: 'wed', 4: 'thu', 5: 'fri', 6: 'sat' };
    const todayKey = dayMap[today];
    
    document.querySelectorAll('.location-card').forEach((card, index) => {
      const hoursItem = card.querySelector(`.hours-item[data-day="${todayKey}"]`);
      const todayHoursText = card.querySelector('.today-hours-text');
      
      if (hoursItem && todayHoursText) {
        const hoursTime = hoursItem.querySelector('.hours-time');
        if (hoursTime && !hoursTime.classList.contains('closed')) {
          todayHoursText.textContent = hoursTime.textContent;
        } else {
          todayHoursText.textContent = 'Closed';
        }
      }
    });
  }
  
  // Update today's hours on load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', updateTodayHours);
  } else {
    updateTodayHours();
  }
  
  // Update status badges (simplified - full implementation would check current time)
  document.querySelectorAll('.openstatus').forEach((statusEl, index) => {
    const todayHoursText = statusEl.closest('.location-card')?.querySelector('.today-hours-text');
    if (todayHoursText && todayHoursText.textContent !== 'Closed') {
      const openBadge = statusEl.querySelector('.status-badge.open');
      if (openBadge) {
        openBadge.classList.remove('hide');
      }
    }
  });
})();
</script>
{{ end }}
