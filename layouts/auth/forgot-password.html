<!DOCTYPE html>
<html lang="{{ site.Language.Lang }}">
<head>
  {{ partial "head.html" . }}
  <link rel="stylesheet" href="{{ site.BaseURL }}css/auth.css">
</head>
<body>
  <div class="auth-container">
    <div class="auth-card">
      <div class="auth-header">
        <img src="{{ site.BaseURL }}branding/ttmenus.gif" alt="TTMenus Logo" class="auth-logo">
        <h1 class="auth-title">Forgot Password</h1>
        <p class="auth-subtitle">Enter your email to reset your password</p>
      </div>

      <!-- Alert Messages -->
      <div id="alertContainer"></div>

      <!-- Forgot Password Form -->
      <form id="forgotPasswordForm" class="auth-form">
        <div class="form-group">
          <label for="email" class="form-label">Email Address</label>
          <input 
            type="email" 
            id="email" 
            name="email" 
            class="form-input" 
            placeholder="you@example.com"
            required
            autocomplete="email"
          >
          <div class="form-error" id="emailError"></div>
        </div>

        <button type="submit" class="btn-primary" id="resetBtn">
          Send Reset Link
        </button>
      </form>

      <div class="auth-divider">
        <span>Remember your password?</span>
      </div>

      <a href="/login/" class="btn-secondary" style="display: inline-block; text-align: center; text-decoration: none;">
        Back to Login
      </a>

      <div class="auth-links" style="margin-top: 20px;">
        <a href="/" class="auth-link">‚Üê Back to Home</a>
      </div>
    </div>
  </div>

  <!-- Forgot Password Script -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('forgotPasswordForm');
      const emailInput = document.getElementById('email');
      const resetBtn = document.getElementById('resetBtn');
      const alertContainer = document.getElementById('alertContainer');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        // Clear previous errors
        clearErrors();

        const email = emailInput.value.trim();

        if (!email) {
          showError('emailError', 'Email is required');
          return;
        }

        // Show loading state
        resetBtn.disabled = true;
        resetBtn.innerHTML = '<span class="spinner"></span> Sending...';

        try {
          const result = await AuthClient.forgotPassword(email);

          if (result.success) {
            showAlert('success', 'Password reset link has been sent to your email if the account exists.');
            form.reset();
            
            // Redirect to login after delay
            setTimeout(() => {
              window.location.href = '/login/';
            }, 3000);
          } else {
            // Still show success message for security (don't reveal if email exists)
            showAlert('success', 'If the email exists, a password reset link has been sent.');
            form.reset();
          }
        } catch (error) {
          console.error('Forgot password error:', error);
          showAlert('error', 'An unexpected error occurred. Please try again.');
        } finally {
          resetBtn.disabled = false;
          resetBtn.innerHTML = 'Send Reset Link';
        }
      });

      function showError(elementId, message) {
        const errorElement = document.getElementById(elementId);
        if (errorElement) {
          errorElement.textContent = message;
          errorElement.classList.add('show');
          
          const inputId = elementId.replace('Error', '');
          const input = document.getElementById(inputId);
          if (input) {
            input.classList.add('error');
          }
        }
      }

      function clearErrors() {
        document.querySelectorAll('.form-error').forEach(el => {
          el.textContent = '';
          el.classList.remove('show');
        });
        document.querySelectorAll('.form-input').forEach(el => {
          el.classList.remove('error');
        });
      }

      function showAlert(type, message) {
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type}`;
        alertDiv.textContent = message;
        alertContainer.innerHTML = '';
        alertContainer.appendChild(alertDiv);
      }

      emailInput.addEventListener('input', () => {
        emailInput.classList.remove('error');
        document.getElementById('emailError').classList.remove('show');
      });
    });
  </script>
</body>
</html>

