{{ define "main" }}
  

  <!--{{ $dateMachine := .Date | time.Format "2006-01-02T15:04:05-07:00" }}
  {{ $dateHuman := .Date | time.Format ":date_long" }}
  <time datetime="{{ $dateMachine }}">{{ $dateHuman }}</time-->
  {{if not (eq .Section ("advertisments")) }}
    <div class="main-content">
      <div class="single-page-item-card">
        {{ $category :=  .Section  }}
        {{ $categoryurl := .Parent.Permalink }}            
        {{$sizes := slice}}
        {{range .Params.prices}}
          {{if not (in $sizes .size)}}
            {{$sizes = $sizes | append .size}}
          {{end}}
        {{end}}

        {{$flavours := slice}}
        {{range .Params.prices}}
          {{if not (in $flavours .flavour)}}
            {{$flavours = $flavours | append .flavour}}
          {{end}}
        {{end}}
        
              {{if .Params.images }}
          <div class="single-page-image-container">
                {{range .Params.images }}
              <img class="single-page-image" src="/{{ .image }}" alt="{{ $.Title }}" loading="lazy">
                {{ end }}
              </div>
              {{ else }}
          <div class="single-page-image-container">
            <img class="single-page-image" src="/branding/favicon-400x200.webp" alt="{{ .Title }}" loading="lazy">  
          </div>
              {{ end }}  
        
        <div class="single-page-content">
          <h1 class="single-page-title">{{ .Title }}</h1>
          
          <div class="single-page-description">
              {{ .Content }}
          </div>
          
              {{$allprices := .Params.prices}}
          {{ if gt (len $sizes) 0 }}
            <div class="single-page-prices-section">
              {{ range $index, $currentItem := $sizes }}
                <div class="price-group">
                  <h3 class="price-group-title">{{ $currentItem }}</h3>
                <ul class="prices">
                  {{ range $allprices }}
                    {{ if eq $currentItem .size }}
                      <li>
                        {{ $price := float .price }}
                        {{ .flavour }} <b>${{ (printf "%.2f" $price) | replaceRE "\\.00$" "" }}</b>
                      </li>
                    {{ end }}
                  {{ end }}
                </ul>
                </div>
              {{ end }}
            </div>
          {{ end }}
          
          <!-- Add to Cart Section -->
          <div class="single-page-add-cart">
            <div class="single-page-quantity-control">
              <button class="btn-quantity" onclick="adjustSinglePageQuantity(this, -1)">
                <i class="fa fa-chevron-down"></i>
              </button>
              <span class="single-page-quantity" data-item-url="{{ .RelPermalink }}">1</span>
              <button class="btn-quantity" onclick="adjustSinglePageQuantity(this, 1)">
                <i class="fa fa-chevron-up"></i>
              </button>
              <span class="single-page-price">
                {{$counter := 0}}
                {{$number := slice}}
                {{$total := 0}}
                {{range .Params.prices}}
                  {{$counter = add $counter 1}}
                  {{$number = $number | append .price}}
                  {{$total = add $total .price}}
                {{end}} 
                {{$number := sort $number}}
                {{ if eq (index $number 0) (index $number (sub $counter 1)) }}
                  {{ $price := float (index $number (sub $counter 1)) }}
                  ${{ (printf "%.2f" $price) | replaceRE "\\.00$" "" }}
                {{else }}
                  {{ $price1 := float (index $number 0) }}
                  {{ $price2 := float (index $number (sub $counter 1)) }}
                  ${{ (printf "%.2f" $price1) | replaceRE "\\.00$" "" }} | ${{ (printf "%.2f" $price2) | replaceRE "\\.00$" "" }}      
              {{ end }}                        
              </span>
            </div>
            <button class="single-page-add-cart-btn" onclick="addSinglePageItemToCart(this, '{{ .RelPermalink }}')">
              <i class="fa fa-cart-plus"></i>
              <span class="cart-button-text">Add to Cart</span>
              <span class="cart-button-price"></span>
            </button>
          </div>
        </div>
      </div>
  {{ else }}
    <div class="singlepagemenu {{ .Section }}">
      {{ if gt (len .Params.images) 0 }}
        <a href="{{ .Params.link }}" class="singlepageimages">
          {{ range .Params.images }}
            <img src="/{{ .image }}" alt="{{ $.Title }}" loading="lazy">
          {{ end }}
        </a>
      {{ else }}
        <img id="singlepageimage" src="/branding/favicon-400x200.webp" alt="{{ .Title }}" loading="lazy">  
      {{ end }}  
      <h1>{{ .Title }}</h1>
      {{ range .Params.youtube }}
        <iframe style="margin-inline: auto;display: block;" width="315" height="560" 
            src="{{ .url }}" 
            title="YouTube video player" 
            frameborder="0" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
            allowfullscreen>
        </iframe>
      {{ end }}
      {{ .Content }}
    </div>
  {{ end }}
  {{ partial "utilities/terms.html" (dict "taxonomy" "tags" "page" .) }}
  {{ partial "utilities/terms.html" (dict "taxonomy" "ingredients" "page" .) }}
  {{ partial "utilities/terms.html" (dict "taxonomy" "cookingmethods" "page" .) }}
  {{ partial "utilities/terms.html" (dict "taxonomy" "types" "page" .) }}
  {{ partial "utilities/terms.html" (dict "taxonomy" "events" "page" .) }}
  
  {{ partial "socialmedia/share-button.html" . }}
{{ end }}
