{{ warnf "Generating JSON file for Home Page: %s" .Title }}
{{- with .Site.Home }}

  {{- $images := slice -}}
  {{- range .Params.images }}
    {{- $images = $images | append (dict "image" .image) -}}
  {{- end }}

  {{- $clientTourImages := slice -}}
  {{- range .Params.clienttourimages }}
    {{- $clientTourImages = $clientTourImages | append (dict "image" .image) -}}
  {{- end }}

  {{- $locations := slice -}}
  {{- with site.Data.locations.locations }}
    {{- range . }}
      {{- $locationData := dict
          "address"  .address
          "city"     .city
          "island"   .island
          "subcategories"  .subcategories
          "orderingtables" .orderingtables
          "latlon"    .latlon
          "phone"    .phone
          "whatsapp" .whatsapp
          "delivery" .delivery
          "opening_hours" .opening_hours
        -}}
      {{- $locations = $locations | append $locationData -}}
    {{- end }}
  {{- end }}

  {{- $social := dict -}}
  {{- with .Params.facebook }}{{ $social = merge $social (dict "facebook" .) }}{{ end }}
  {{- with .Params.instagram }}{{ $social = merge $social (dict "instagram" .) }}{{ end }}
  {{- with .Params.youtube }}{{ $social = merge $social (dict "youtube" .) }}{{ end }}
  {{- with .Params.tiktok }}{{ $social = merge $social (dict "tiktok" .) }}{{ end }}
  
  {{- $features := dict -}}
  {{- with site.Params.features }}
    {{- with .payments }}{{ $features = merge $features (dict "payments" .) }}{{ end }}
    {{- with .delivery }}{{ $features = merge $features (dict "delivery" .) }}{{ end }}
    {{- with .notifications }}{{ $features = merge $features (dict "notifications" .) }}{{ end }}
  {{- end }}

  {{- $json := dict
      "title" .Title
      "hero_background_image" (.Params.image | default "")
      "featured_images" $images
      "client_tour_images" $clientTourImages
      "locations" $locations
      "social_links" $social
      "features" $features
      "categories"  (.Params.categories | default "")
      "tags" (.Params.tags | default slice)
      "type" (.Params.type | default slice)
      "content" (.Content | default "")
  -}}

  {{ $json | jsonify }}

{{- end }}
