<!DOCTYPE html>
<html lang="{{ site.Language.LanguageCode }}" dir="{{ or site.Language.LanguageDirection `ltr` }}">
<head>
  {{ partial "head.html" . }}
</head>
<body>
  {{ partial "loader.html" . }}
  {{ partial "askofserver.html" . }}
  <div data-barba="wrapper">
    <div data-barba="container" data-barba-namespace="{{ .Title }}">
      <header>
        {{ partial "header.html" . }}
      </header>
      {{ partialCached "ttms-dashboard/dashboard.html" . }}
      {{ partial "search.html" . }}
      <main id="main">
        {{ block "main" . }}{{ end }}
        <div id="ad-slot-footer" data-placement="footer">
          <!-- Footer ad will load here -->
        </div>
      </main>
    </div>
  </div>
  <footer>
    {{ partial "order_modal.html" . }}
    {{ partial "footer.html" . }}
  </footer>
  
  <!--script src="https://ct.ttmenus.com/js/loader.js"></script-->
  <script src="https://code.jquery.com/jquery-2.2.0.js"></script>

  <!-- <script src="{{ site.BaseURL}}/src/app.js"></script> -->
  <!-- <script src="{{ site.BaseURL}}/js/test.js"></script> -->
  <link rel="stylesheet" href="{{ site.BaseURL}}js/custom.js"/> 


  <script src="https://ct.ttmenus.com/js/askforserver.js"></script>
  <script src="https://ct.ttmenus.com/js/cart.js"></script>
  <script src="https://ct.ttmenus.com/js/search.js"></script>

  <!--script src="https://ct.ttmenus.com/js/order_system.js"></script-->
  <!--script src="https://ct.ttmenus.com/js/script.js"></script>
  <script src="https://ct.ttmenus.com/js/wapos.js"></script-->

  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

  <!-- jsdelivr -->
  <script src="https://cdn.jsdelivr.net/npm/@barba/core"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
    
});
    document.addEventListener('DOMContentLoaded', function() {
        const loader = document.getElementById('loader');
        const loaderImage = document.getElementById('loaderImage');
        let animations = [  'loader-hide-up',
                            'loader-hide-up-right',
                            'loader-hide-right',
                            'loader-hide-down-right',
                            'loader-hide-down',
                            'loader-hide-down-left',
                            'loader-hide-left',
                            'loader-hide-up-left',
                            'loader-hide-up-rotate-left',
                            'loader-hide-up-right-rotate-left',
                            'loader-hide-right-rotate-left',
                            'loader-hide-down-right-rotate-left',
                            'loader-hide-down-rotate-left',
                            'loader-hide-down-left-rotate-left',
                            'loader-hide-left-rotate-left',
                            'loader-hide-up-left-rotate-left',
                            'loader-hide-up-rotate-right',
                            'loader-hide-up-right-rotate-right',
                            'loader-hide-right-rotate-right',
                            'loader-hide-down-right-rotate-right',
                            'loader-hide-down-rotate-right',
                            'loader-hide-down-left-rotate-right',
                            'loader-hide-left-rotate-right',
                            'loader-hide-up-left-rotate-right',
                            'loader-hide-up-rotate-scale',
                            'loader-hide-up-right-rotate-scale',
                            'loader-hide-right-rotate-scale',
                            'loader-hide-down-right-rotate-scale',
                            'loader-hide-down-rotate-scale',
                            'loader-hide-down-left-rotate-scale',
                            'loader-hide-left-rotate-scale',
                            'loader-hide-up-left-rotate-scale'];
        let randomAnim ='';
        function showLoader() {
            loader.classList.remove('loader-hide-up');
            loader.classList.remove('loader-hide-up-right');
            loader.classList.remove('loader-hide-right');
            loader.classList.remove('loader-hide-down-right');
            loader.classList.remove('loader-hide-down');
            loader.classList.remove('loader-hide-down-left');
            loader.classList.remove('loader-hide-left');
            loader.classList.remove('loader-hide-up-left');
            loader.classList.remove('loader-hide-up-rotate-left');
            loader.classList.remove('loader-hide-up-right-rotate-left');
            loader.classList.remove('loader-hide-right-rotate-left');
            loader.classList.remove('loader-hide-down-right-rotate-left');
            loader.classList.remove('loader-hide-down-rotate-left');
            loader.classList.remove('loader-hide-down-left-rotate-left');
            loader.classList.remove('loader-hide-left-rotate-left');
            loader.classList.remove('loader-hide-up-left-rotate-left');
            loader.classList.remove('loader-hide-up-rotate-right');
            loader.classList.remove('loader-hide-up-right-rotate-right');
            loader.classList.remove('loader-hide-right-rotate-right');
            loader.classList.remove('loader-hide-down-right-rotate-right');
            loader.classList.remove('loader-hide-down-rotate-right');
            loader.classList.remove('loader-hide-down-left-rotate-right');
            loader.classList.remove('loader-hide-left-rotate-right');
            loader.classList.remove('loader-hide-up-left-rotate-right');
            loader.classList.remove('loader-hide-up-rotate-scale');
            loader.classList.remove('loader-hide-up-right-rotate-scale');
            loader.classList.remove('loader-hide-right-rotate-scale');
            loader.classList.remove('loader-hide-down-right-rotate-scale');
            loader.classList.remove('loader-hide-down-rotate-scale');
            loader.classList.remove('loader-hide-down-left-rotate-scale');
            loader.classList.remove('loader-hide-left-rotate-scale');
            loader.classList.remove('loader-hide-up-left-rotate-scale');
            // console.log("Show loader");
        }
        
        

        function hideLoader() {
            randomAnim = animations[Math.floor(Math.random() * animations.length)];
            loader.classList.add(randomAnim);
            initAOS();
            AOS.refresh();
            // console.log("hide loader");
        }

        function getAd() {
          randomAd = animations[Math.floor(Math.random() * animations.length)];
          loaderImage.setAttribute('src',randomAd);
          // console.log("hide loader");
        }

        barba.init({
            cacheIgnore: true,
            transitions: [{
                name: 'fade',
                async leave(data) {
                  localStorage.setItem("headerScroll", document.getElementById("menublock").scrollLeft);
                  showLoader();
                  await new Promise(resolve => setTimeout(resolve, 366));

                },
                async enter(data) {
                  window.scrollTo(0, 100);
                  document.getElementById('menublock').scrollTo(12, 0);
                  closeCart();
                  closeShop();
                  await new Promise(resolve => setTimeout(resolve, 366));
                  hideLoader();
                 const savedScroll = localStorage.getItem("headerScroll");
                  if (savedScroll !== null) {
                    requestAnimationFrame(() => { // Ensures DOM is ready before applying scroll
                      document.getElementById("menublock").scrollLeft = savedScroll;
                    });
                  }
                  window.scrollTo(0, 0);
                },
                async once(data) {
                  await new Promise(resolve => setTimeout(resolve, 3000));
                  hideLoader();
                  document.getElementById("menuImage").classList.add('hide');
               
                }
            }]
        });
    });
    
    // Function to load content dynamically
    function lazyLoadContent(container) {
      container.querySelectorAll("[data-lazy-load]").forEach(async (element) => {
        const url = element.getAttribute("data-barba");
        if (!url) return;

        try {
          const response = await fetch(url);
          const content = await response.text();
          element.innerHTML = content; // Insert the loaded content
        } catch (error) {
          console.error("Failed to load content:", error);
        }
      });
    }
    const header = document.querySelector(".header"); // Adjust selector as needed

    window.addEventListener("beforeunload", () => {
        localStorage.setItem("headerScroll", header.scrollLeft);
    });
  </script>

  <script type="text/javascript">
    function initAOS() {
      AOS.init();
      console.log("AOS init");
    }

    document.addEventListener("DOMContentLoaded", function () {
      initAOS();
    });

    document.addEventListener("barba:after", function () {
      AOS.refreshHard(); // Reinitialize AOS after a page transition
      console.log("AOS refreshHard");
    });

    window.addEventListener("scroll", () => {
      AOS.refresh();
    });
  </script>
  <script>
  (async () => {
    const siteId = "your-real-site-id"; // 🔥 Replace this with your real Hugo site ID
    const page = window.location.pathname;

    try {
      const response = await fetch(`https://ads.ttmenus.com/ads?hugo_site_id=${siteId}&page=${page}`);
      if (!response.ok) {
        console.error("Failed to fetch ads:", response.statusText);
        return;
      }

      const data = await response.json();
      console.log("✅ Ads fetched successfully:", data);

      if (!data.ads || data.ads.length === 0) {
        console.warn("⚠️ No ads received for this page.");
      } else {
        ["top", "footer"].forEach(placement => {
          const slot = document.querySelector(`[data-placement="${placement}"]`);
          const ad = data.ads.find(a => a.placement === placement);
          
          if (slot && ad) {
            slot.innerHTML = `
              <a href="${ad.link}" target="_blank" rel="noopener noreferrer">
                <img src="${ad.image}" alt="Advertisement" style="max-width: 100%; height: auto; display: block; margin: auto;" />
              </a>
            `;
          } else if (slot) {
            console.warn(`⚠️ No ad available for placement: '${placement}'`);
          }
        });
      }
    } catch (error) {
      console.error("🚨 Error fetching ads:", error);
    }
  })();
  </script>
  {{ partial "whatsapp_ordering_system.html" . }}

</body>
</html>
