{{/*
  Universal Share Button
  Uses native Web Share API on mobile devices, clipboard fallback on desktop
  
  Usage: {{ partial "socialmedia/share-button.html" . }}
  
  Optional parameters (pass as dict):
  - text: Text to share (defaults to page title)
  - url: URL to share (defaults to current page)
*/}}

{{/* Simply use the page title and permalink */}}
{{ $text := .Title }}
{{ $url := .Permalink }}
{{ $fullUrl := $url | absURL }}
<div class="social-share-btn-container">
    <button onclick="shareContent('{{ $text }}', '{{ $fullUrl }}')" 
            class="universal-share-btn social-share-btn"
            aria-label="Share this page"
            title="Share this page">
    <svg class="share-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M18 16.08C17.24 16.08 16.56 16.38 16.04 16.85L8.91 12.7C8.96 12.47 9 12.24 9 12C9 11.76 8.96 11.53 8.91 11.3L15.96 7.19C16.5 7.69 17.21 8 18 8C19.66 8 21 6.66 21 5C21 3.34 19.66 2 18 2C16.34 2 15 3.34 15 5C15 5.24 15.04 5.47 15.09 5.7L8.04 9.81C7.5 9.31 6.79 9 6 9C4.34 9 3 10.34 3 12C3 13.66 4.34 15 6 15C6.79 15 7.5 14.69 8.04 14.19L15.16 18.35C15.11 18.56 15.08 18.78 15.08 19C15.08 20.61 16.39 21.92 18 21.92C19.61 21.92 20.92 20.61 20.92 19C20.92 17.39 19.61 16.08 18 16.08Z" fill="currentColor"/>
    </svg>
    <span class="share-text">Share</span>
    </button>
</div>
<script>
function shareContent(title, url) {
  // Try native share API first (works on mobile and some desktop browsers)
  if (navigator.share) {
    navigator.share({
      title: title,
      text: title,
      url: url
    }).then(() => {
      console.log('Shared successfully');
    }).catch((error) => {
      console.log('Error sharing:', error);
      // If user cancels, don't show fallback
      if (error.name !== 'AbortError') {
        fallbackShare(title, url);
      }
    });
  } else {
    // Fallback for desktop browsers without Web Share API
    fallbackShare(title, url);
  }
}

function fallbackShare(title, url) {
  // Copy URL to clipboard
  const shareText = title + '\n\n' + url;
  
  if (navigator.clipboard) {
    navigator.clipboard.writeText(shareText).then(() => {
      showShareNotification('Link copied to clipboard!');
    }).catch(() => {
      showShareNotification('Unable to copy. URL: ' + url);
    });
  } else {
    // Fallback for older browsers
    const textArea = document.createElement('textarea');
    textArea.value = shareText;
    textArea.style.position = 'fixed';
    textArea.style.left = '-999999px';
    document.body.appendChild(textArea);
    textArea.select();
    try {
      document.execCommand('copy');
      showShareNotification('Link copied to clipboard!');
    } catch (err) {
      showShareNotification('Unable to copy. URL: ' + url);
    }
    document.body.removeChild(textArea);
  }
}

function showShareNotification(message) {
  // Create a simple notification
  const notification = document.createElement('div');
  notification.className = 'share-notification';
  notification.textContent = message;
  document.body.appendChild(notification);
  
  // Show notification
  setTimeout(() => {
    notification.classList.add('show');
  }, 10);
  
  // Hide and remove after 3 seconds
  setTimeout(() => {
    notification.classList.remove('show');
    setTimeout(() => {
      document.body.removeChild(notification);
    }, 300);
  }, 3000);
}
</script>

<style>
.universal-share-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 0.75rem 1.25rem;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  text-decoration: none;
  border: none;
  border-radius: 8px;
  transition: all 0.3s ease;
  font-weight: 500;
  box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
  cursor: pointer;
  font-family: inherit;
  font-size: 1rem;
}

.universal-share-btn:hover {
  background: linear-gradient(135deg, #5568d3 0%, #6a3f8f 100%);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.universal-share-btn:active {
  transform: translateY(0);
  box-shadow: 0 2px 6px rgba(102, 126, 234, 0.3);
}

.universal-share-btn .share-icon {
  width: 20px;
  height: 20px;
  color: white;
}

.universal-share-btn .share-text {
  font-size: 1rem;
  color: white;
}
.social-share-btn-container {
    display: flex;
    justify-content: center;
    align-items: center;
    padding-block-end: 1rem;
}
/* Share notification */
.share-notification {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%) translateY(100px);
  background: rgba(0, 0, 0, 0.85);
  color: white;
  padding: 1rem 1.5rem;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  z-index: 10000;
  opacity: 0;
  transition: all 0.3s ease;
  font-size: 0.9rem;
  text-align: center;
}

.share-notification.show {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}

@media (max-width: 768px) {
  .universal-share-btn {
    padding: 0.5rem 1rem;
  }
  
  .universal-share-btn .share-text {
    font-size: 0.9rem;
  }
}
</style>

