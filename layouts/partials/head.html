<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>{{ if .IsHome }}{{ site.Title }}{{ else }}{{ printf "%s | %s" .Title site.Title }}{{ end }}</title>
<meta name="description" content="{{ if .Description }}{{ .Description }}{{ else }}{{ site.Params.description | default "Delicious food and drinks at great prices. View our digital menu and order online." }}{{ end }}">

<!-- Preload critical loader resources FIRST -->
<link rel="preload" href="https://ct.ttmenus.com/branding/ttmenus/ttmenus.gif" as="image" fetchpriority="high">
<link rel="preload" href="/branding/favicon144.webp" as="image" fetchpriority="high">
<link rel="preload" href="https://ct.ttmenus.com/css/loader.css" as="style" fetchpriority="high">

<!-- Inline critical loader CSS for instant rendering -->
<style>
  /* Critical loader styles - inline for instant display */
  #loader {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: var(--background-color, #000);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 99999;
    transition: opacity 0.5s ease-out, transform 0.5s ease-out;
  }
  
  #loader img {
    max-width: 200px;
    max-height: 200px;
    object-fit: contain;
    image-rendering: -webkit-optimize-contrast;
  }
  
  #loaderImage {
    
    animation: pulse 1.5s ease-in-out infinite;
  }
  
  #menuImage {
    width: 120px;
    height: 120px;
  }
  
  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.8; transform: scale(1.05); }
  }
  
  /* Hide classes for loader animations - basic fallback */
  #loader.loader-hide-up,
  #loader.loader-hide-down,
  #loader.loader-hide-left,
  #loader.loader-hide-right {
    opacity: 0;
    pointer-events: none;
  }
  
  #loader.loader-hide-up { transform: translateY(-100%); }
  #loader.loader-hide-down { transform: translateY(100%); }
  #loader.loader-hide-left { transform: translateX(-100%); }
  #loader.loader-hide-right { transform: translateX(100%); }
</style>

<!-- Preconnect to external domains for faster resource loading -->
<link rel="preconnect" href="https://ct.ttmenus.com" crossorigin>
<link rel="preconnect" href="https://cdn.onesignal.com" crossorigin>
<link rel="preconnect" href="https://analytics.ttmenus.com" crossorigin>
<link rel="preconnect" href="https://code.jquery.com" crossorigin>
<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
<link rel="preconnect" href="https://unpkg.com" crossorigin>
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

{{ partialCached "head/css.html" . }}
{{ partialCached "head/js.html" . }}
<meta property="og:title" content="{{ .Title }} | {{ site.Title }}"/>
{{$images := slice}}
{{range .Params.images }}
  {{$images = $images | append .image}}
{{end}}
{{ if gt (len $images) 0 }}
  {{$firstImage := index $images 0}}
  <meta property="og:image" content="/{{ $firstImage }}"/>
{{ else }} 
   <meta property="og:image" content="/branding/favicon152.webp"/>
{{ end }}

<!--APPLE SUPPORT-->
<meta name="apple-mobile-web-app-title" content="{{ site.Title }}">
<meta name="description" content="{{ .Summary }} "/>
<meta property="og:description" content="{{ .Summary }} Digital Menu"/>

<!-- WEBSITE LINK AND IMAGE -->
<meta property="og:url" content="{{ site.GetPage.Permalink }}" />

<!-- APP THEME COLOR -->
<meta name="theme-color" content="#000000"/>

<!-- MAIN APP STYLE - Critical CSS loaded synchronously -->
<link rel="stylesheet" href="{{ site.BaseURL}}css/colors.css"/>
<link rel="stylesheet" href="{{ site.BaseURL}}css/custom.css"/>
<link rel="stylesheet" href="https://ct.ttmenus.com/css/loader.css"/>

<!-- Non-critical CSS loaded with low priority -->
<link rel="stylesheet" href="{{ site.BaseURL}}src/css/adsbase.css"/>

<link rel="preload" href="{{ site.BaseURL}}src/css/apple.css" as="style" onload="this.onload=null;this.rel='stylesheet'"/>
<noscript><link rel="stylesheet" href="{{ site.BaseURL}}src/css/apple.css"/></noscript>

<link rel="preload" href="{{ site.BaseURL}}src/css/ordering-system.css" as="style" onload="this.onload=null;this.rel='stylesheet'"/>
<noscript><link rel="stylesheet" href="{{ site.BaseURL}}src/css/ordering-system.css"/></noscript>

<link rel="preload" href="https://ct.ttmenus.com/css/animations.css" as="style" onload="this.onload=null;this.rel='stylesheet'"/>
<noscript><link rel="stylesheet" href="https://ct.ttmenus.com/css/animations.css"/></noscript>

<link rel="preload" href="https://ct.ttmenus.com/css/dinein_select.css" as="style" onload="this.onload=null;this.rel='stylesheet'"/>
<noscript><link rel="stylesheet" href="https://ct.ttmenus.com/css/dinein_select.css"/></noscript>

<link rel="preload" href="https://ct.ttmenus.com/css/search.css" as="style" onload="this.onload=null;this.rel='stylesheet'"/>
<noscript><link rel="stylesheet" href="https://ct.ttmenus.com/css/search.css"/></noscript>

<!-- MANIFEST -->
<link rel="manifest" href="/manifest.json" />

<!--APPLE SUPPORT and ALL ICONS-->
<link rel="apple-touch-icon" href="/branding/favicon192.webp" />
<link rel="shortcut icon" sizes="16x16" href="/branding/favicon16.webp">
<link rel="shortcut icon" sizes="196x196" href="/branding/favicon.ico">
<link rel="shortcut icon" sizes="196x196" href="/branding/favicon196.webp">
<link rel="apple-touch-icon" href="/branding/favicon192.webp" />
<link rel="shorcut icon" href="/branding/favicon512.webp"/>
<link rel="apple-touch-icon-precomposed" href="/branding/favicon152.webp">

<!--ANIMATE ON SCROLL ANIMATIONS - deferred -->
<link rel="preload" href="https://unpkg.com/aos@2.3.1/dist/aos.css" as="style" onload="this.onload=null;this.rel='stylesheet'"/>
<noscript><link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet"></noscript>

<!-- Font Awesome with font-display optimization -->
<link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"/>
<noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"></noscript>
<style>
  /* Font-display optimization for Font Awesome */
  @font-face {
    font-family: 'FontAwesome';
    font-display: swap;
  }
</style>

<!-- FONTS FOR THE MENU -->
<!-- <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200anddisplay=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Black+Ops+Oneanddisplay=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@400;700anddisplay=swap" rel="stylesheet"> -->

<script>
    if (typeof navigator.serviceWorker !== 'undefined') {
        navigator.serviceWorker.register('{{ site.BaseURL}}OneSignalSDKWorker.js?v=2')
        .then(function(registration) {
        console.log('Service Worker registered with scope:', registration.scope);
        })
        .catch(function(error) {
        console.error('Service Worker registration failed:', error);
        });
    }
</script>
<script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
<script>
  window.OneSignalDeferred = window.OneSignalDeferred || [];
  OneSignalDeferred.push(function(OneSignal) {
    const appId = "{{ site.Params.services.onesignalid }}";
    
    // Only initialize if appId is provided and valid (check if it's not empty and doesn't contain template syntax)
    if (appId && appId.trim() !== "" && appId.indexOf("{" + "{") === -1) {
      OneSignal.init({
        appId: appId,
      }).catch(function(error) {
        console.warn('OneSignal initialization error:', error.message);
        // If there's an appId mismatch, we could clear the service worker
        if (error.message.includes("AppID doesn't match")) {
          console.log('OneSignal: AppID mismatch detected. Service worker may need to be cleared.');
        }
      });
    } else {
      console.warn('OneSignal: Invalid or missing appId, skipping initialization');
    }
  });
</script>
<!-- Matomo Tag Manager - Deferred for performance -->
<script>
  // Defer analytics initialization
  window.addEventListener('load', function() {
    var _mtm = window._mtm = window._mtm || [];
    _mtm.push({'mtm.startTime': (new Date().getTime()), 'event': 'mtm.Start'});
    (function() {
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.async=true; g.src='https://analytics.ttmenus.com/js/container_sfESrf87.js'; s.parentNode.insertBefore(g,s);
    })();
  });
</script>
<!-- End Matomo Tag Manager -->
<!-- Matomo Global and Client Tracking - Deferred -->
<script>
  window.addEventListener('load', function() {
    var _paq = window._paq = window._paq || [];

    /* Default tracker: ttmenus.com (Site ID 1) */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setCookieDomain", "*.ttmenus.com"]);
    _paq.push(["setDomains", ["*.ttmenus.com"]]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);

    /* Add second tracker: wingit.ttmenus.com (Site ID 6) */
    _paq.push(['addTracker', 'https://analytics.ttmenus.com/matomo.php', '{{ site.Params.services.analyticsid }}']);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);

    (function() {
      var u="//analytics.ttmenus.com/";
      _paq.push(['setTrackerUrl', u+'matomo.php']);
      _paq.push(['setSiteId', '1']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
    })();
  });
</script>
<noscript><p><img referrerpolicy="no-referrer-when-downgrade" src="//analytics.ttmenus.com/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt="" /></p></noscript>
<!-- End Matomo Code -->

<!-- TTMS Analytics Tracking - Deferred -->
<script src="{{ site.BaseURL}}js/analytics-tracking.js" defer></script>

{{- if site.Params.posintegration.enabled -}}
<script>
// POS Integration Configuration
window.POS_CONFIG = {
    enabled: {{ site.Params.posintegration.enabled }},
    provider: "{{ site.Params.posintegration.provider }}",
    apiUrl: "{{ site.Params.posintegration.api_url }}",
    accessToken: "{{ site.Params.posintegration.access_token }}",
    storeId: "{{ site.Params.posintegration.store_id }}",
    syncMenu: {{ site.Params.posintegration.sync_menu }},
    autoProcessOrders: {{ site.Params.posintegration.auto_process_orders }},
    fallbackToWhatsapp: {{ site.Params.posintegration.fallback_to_whatsapp }}
};
</script>
<script src="/js/pos-integration.js"></script>
{{- end -}}

{{- if site.Params.auth.enabled -}}
<script>
// Auth Service Configuration
window.AUTH_CONFIG = {
    apiUrl: "{{ site.Params.auth.apiUrl }}"
};
// Set current site's client ID for access control
window.SITE_CLIENT_ID = "{{ .Site.Params.clientID }}";
</script>
<script src="{{ site.BaseURL }}js/auth-client.js"></script>
<script src="{{ site.BaseURL }}js/auth-middleware.js"></script>
<script src="{{ site.BaseURL }}js/auth-client-access.js"></script>
<script src="{{ site.BaseURL }}js/admin-users.js"></script>
{{- end -}}